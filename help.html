<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Â∏ÆÂä©ËØ∑Ê±ÇË°®Âçï / Help Request Form</title>
  <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;700&display=swap" rel="stylesheet">
  <style>
   body {
  font-family: 'Segoe UI', 'Helvetica Neue', Arial, 'PingFang SC', 'Microsoft YaHei', sans-serif;
  background: linear-gradient(135deg, #e0e7ff 0%, #f1f5f9 100%);
  margin: 0;
  padding: 0;
  min-height: 100vh;
}
.container, .leaderboard-container {
  width: 100%;
  max-width: 410px;
  margin: 32px auto 0;
  background: #fff;
  padding: 24px 18px 18px 18px;
  border-radius: 15px;
  box-shadow: 0 8px 24px rgba(50,60,90,.10);
}
@media (max-width: 520px) {
  .container, .leaderboard-container {
    max-width: 98vw;
    margin: 18px auto 0;
    padding: 12px 4vw 14px 4vw;
    border-radius: 10px;
  }
}
h2, h3 {
  text-align: center;
  color: #334155;
  margin-bottom: 15px;
  font-weight: 700;
  letter-spacing: 0.4px;
}
label {
  display: block;
  margin-top: 14px;
  font-weight: 600;
  color: #475569;
}
input, textarea {
  width: 100%;
  padding: 10px 12px;
  margin-top: 6px;
  border: 1px solid #e5e7eb;
  border-radius: 7px;
  font-size: 15px;
  background: #f8fafc;
  transition: border-color 0.2s;
  font-family: inherit;
  color: #2d3748;
  box-sizing: border-box;
}
input:focus, textarea:focus {
  border-color: #6366f1;
  outline: none;
  background: #fff;
}
.button-group {
  display: flex;
  justify-content: space-between;
  margin-top: 19px;
  gap: 10px;
}
button {
  flex: 1;
  padding: 12px 0;
  font-weight: 700;
  border: none;
  border-radius: 7px;
  background: linear-gradient(90deg, #6366f1 30%, #3b82f6 100%);
  color: #fff;
  font-size: 16px;
  cursor: pointer;
  letter-spacing: 0.2px;
  box-shadow: 0 2px 8px rgba(60,100,255,0.06);
  transition: background 0.22s, transform 0.15s;
}
button:hover {
  background: linear-gradient(90deg, #6366f1 60%, #1e40af 100%);
  transform: translateY(-1px) scale(1.015);
}
.leaderboard-container {
  margin-top: 28px;
  background: #f9fafb;
  border-radius: 15px;
  box-shadow: 0 4px 12px rgba(60,60,60,.05);
  padding: 16px 10px 10px 10px;
}
ul#leaderboardList {
  list-style: none;
  padding: 0;
  margin: 0;
}
ul#leaderboardList li {
  background: #e0e7ff;
  margin-bottom: 8px;
  padding: 10px 14px;
  border-radius: 7px;
  font-size: 15px;
  color: #2d3a4a;
  border: 1px solid #dbeafe;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  min-height: 36px;
}
ul#leaderboardList li span.star {
  font-size: 17px;
  font-weight: bold;
  color: #fbbf24;
  margin-right: 7px;
}
ul#leaderboardList li .name {
  flex: 1 1 auto;
  text-align: left;
  font-weight: 600;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
ul#leaderboardList li .score {
  flex: 0 0 auto;
  font-family: 'Consolas', 'Menlo', 'Courier New', monospace;
  font-weight: bold;
  color: #6366f1;
  font-size: 15.8px;
  letter-spacing: 1px;
}
.footer {
  text-align: center;
  font-size: 13px;
  color: #9ca3af;
  margin: 22px 0 6px 0;
}
iframe[name="hidden_iframe"] {
  display: none;
}

.notice-banner {
  width: 100vw;
  overflow: hidden;
  background: linear-gradient(90deg, #fef9c3 0%, #f1f5f9 100%);
  border-bottom: 1.5px solid #fde68a;
  box-shadow: 0 3px 14px rgba(255,222,89,0.10);
  position: fixed;
  top: 0;
  left: 0;
  z-index: 1000;
  height: 38px;
  display: flex;
  align-items: center;
}

.notice-banner-content {
  display: inline-block;
  white-space: nowrap;
  color: #b45309;
  font-size: 15.5px;
  font-weight: 500;
  padding-left: 100vw;
  /* Make the animation slower and smoother */
  animation: slide-banner 32s linear infinite;
  letter-spacing: 0.12px;
}

@keyframes slide-banner {
  0%   { transform: translateX(0); }
  100% { transform: translateX(-110%); }
}

/* Push the rest of the page down so it's not hidden behind the fixed banner */
body {
  padding-top: 48px !important;
}


  </style>
</head>
<body>
<!-- Sliding Warning Banner -->
<div class="notice-banner">
  <div class="notice-banner-content">
    <strong>Attention:</strong> For your security and the integrity of our team, all requests are tracked with your ID, IP, and the time submitted. Misuse or false reports will be taken seriously and could result in restricted access.
  </div>
</div>

  <!-- Hidden form for Google Sheets (Solved only) -->
  <form id="solverForm"
        action="https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLgZs7jHhp9pK16mVxeEzYHbAx6m3gckL500z2K16ROPO9yipuADtrcdDfx-3acBUqpYRGwj9yEjESobeHodYiHS_6Qpt-pujTyumyHByiiElBy2rA4gysBkLv_pJnpRObk6_vYL9mCKcnZrQ79IzfUWeXjUAFjwQM9Nfn-R1RqAkTjhfhAv3c9dJF_EB77ytOLdvwulDC0FqChXdMmITkD2bKVOZ0Xa1VlROjOf4uaaZO0b7hZTLaop-9zoJfF3NmLLnenTzbT0S8lHZwveSi07hdrrj9x2crrPdg-n&lib=MNrndgbqK3JMB40L7Qz6VuSm4-IgYx82c"
        method="POST"
        target="hidden_iframe"
        style="display:none;">
    <input type="hidden" name="name" id="solverNameInput" />
  </form>
  <iframe name="hidden_iframe"></iframe>

  <div class="container">
    <h2>Â∏ÆÂä©ËØ∑Ê±ÇË°®Âçï / Help Request Form</h2>

    <label for="idTag">‰Ω†ÁöÑIDÊ†áÁ≠æ / Your ID Tag:</label>
    <input type="text" id="idTag" maxlength="20" placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑIDÔºå‰æãÂ¶Ç ZX27 / Enter ID (e.g. ZX27)" />

    <label for="subject">‰∏ªÈ¢ò / Subject:</label>
    <input type="text" id="subject" maxlength="40" placeholder="ÁÆÄË¶Å‰∏ªÈ¢ò / Brief subject" />

    <label for="reason">ÂèëÁîü‰∫Ü‰ªÄ‰πàÔºü/ What‚Äôs going on?</label>
    <textarea id="reason" rows="3" maxlength="200" placeholder="ÊèèËø∞ÈóÆÈ¢ò... / Describe the issue..."></textarea>

    <div class="button-group">
      <button type="button" onclick="sendMessage()">üì© ÂèëÈÄÅ / Send</button>
      <button type="button" onclick="markSolved()">‚úÖ Â∑≤Ëß£ÂÜ≥ / Solved</button>
    </div>
  </div>

  <div class="leaderboard-container" id="leaderboard">
    <h3>üèÜ Ëß£ÂÜ≥ÈóÆÈ¢òÊéíË°åÊ¶ú / Leaderboard</h3>
    <ul id="leaderboardList">Âä†ËΩΩ‰∏≠... / Loading...</ul>
  </div>

  <div class="footer">Designed by Abhi </div>

<script>
const telegramToken = '7200618609:AAFknpgD8aje4QQqwpLMpsTFLjfz4Wjm2dc';
const chatId        = '-1002897706533';
const apiBase       = 'https://script.google.com/macros/s/AKfycbxvFat1k4WtbQ3sT6OEembMk_mGwv8yI0OPPhptpofE6OFxrSy-w4JrLS2dA9H-pkL-DA/exec';

// ID tag validation function
function isValidIdTag(idTag) {
  // Only ZX01-ZX99, WL01-WL99, HX01-HX99 (case-insensitive)
  return /^(ZX|WL|HX)(0[1-9]|[1-9][0-9])$/i.test(idTag.trim());
}

function markSolved() {
  const messageId = localStorage.getItem('lastMessageId');
  if (!messageId) return alert('Â∞öÊó†ËØ∑Ê±ÇÂèØÊ†áËÆ∞ / No request to mark.');

  const solvers = ["Abhi", "Amiru", "Amos", "Bilal", "Chillz", "Lisa", "Namrata", "Bright", "Sasha"];
  const choice = prompt('Ë∞ÅËß£ÂÜ≥‰∫ÜÊ≠§ÈóÆÈ¢òÔºü / Who solved this?\n' + solvers.map((n, i) => `${i + 1}. ${n}`).join("\n"));
  const idx = parseInt(choice);

  if (!idx || idx < 1 || idx > solvers.length) return alert('ÈÄâÊã©Êó†Êïà / Invalid selection.');

  const name = solvers[idx - 1];

  // Telegram update
  fetch(`https://api.telegram.org/bot${telegramToken}/sendMessage`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      chat_id: chatId,
      text: `‚úÖ Solved by ${name}`,
      parse_mode: 'Markdown',
      reply_to_message_id: messageId
    })
  });

  // Google Sheets update
  fetch(apiBase, {
    method: 'POST',
    mode: 'no-cors',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ name })
  });

  setTimeout(loadLeaderboard, 1200);
  // Disable further solving from this browser for this request
  localStorage.removeItem('lastMessageId');
}


function sendMessage() {
  const idTag   = document.getElementById('idTag').value.trim();
  const subject = document.getElementById('subject').value.trim();
  const reason  = document.getElementById('reason').value.trim();
  if (!idTag || !subject || !reason) {
    return alert('ËØ∑Â°´ÂÜôÊâÄÊúâÂ≠óÊÆµ / Please fill in all fields.');
  }
  // ID validation check
  if (!isValidIdTag(idTag)) {
    return alert('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑIDÊ†áÁ≠æ (Â¶Ç ZX01, WL15, HX99) / Please enter a valid ID Tag (e.g. ZX01, WL15, HX99).');
  }

  // Get IP address and current time, then send
  fetch('https://api.ipify.org?format=json')
    .then(response => response.json())
    .then(data => {
      const ip = data.ip;
      const now = new Date();
      const timeString = now.toLocaleString('zh-CN', { hour12: false }) + ` (${Intl.DateTimeFormat().resolvedOptions().timeZone})`;
      const text = `üÜò *Êñ∞Â∏ÆÂä©ËØ∑Ê±Ç New Help Request*\n\nüÜî IDÊ†áÁ≠æ: ${idTag}\nüìå Subject: ${subject}\nüìù Reason: ${reason}\nüåê IP: ${ip}\n‚è∞ Time: ${timeString}`;
      fetch(`https://api.telegram.org/bot${telegramToken}/sendMessage`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ chat_id: chatId, text, parse_mode: 'Markdown' })
      })
      .then(res => res.json())
      .then(data => {
        if (data.ok) {
          localStorage.setItem('lastMessageId', data.result.message_id);
          alert('Ê∂àÊÅØÂ∑≤ÂèëÈÄÅÔºÅMessage sent!');
          document.getElementById('idTag').value = '';
          document.getElementById('subject').value = '';
          document.getElementById('reason').value = '';
        } else {
          alert('ÂèëÈÄÅÂ§±Ë¥• / Failed to send message.');
        }
      })
      .catch(() => alert('ÂèëÈÄÅÂ§±Ë¥• / Failed to send message.'));
    })
    .catch(() => alert('Êó†Ê≥ïËé∑ÂèñIPÂú∞ÂùÄ / Failed to get IP address.'));
}

function loadLeaderboard() {
  fetch(apiBase)
    .then(res => res.json())
    .then(data => {
      const ul = document.getElementById('leaderboardList');
      ul.innerHTML = '';
      data.sort((a,b) => b[1] - a[1]);
      data.forEach(row => {
        const li = document.createElement('li');
        li.innerHTML = `<span class="star">‚≠ê</span>
  <span class="name">${row[0]}</span>
  <span class="score">${row[1]}</span>`;
        ul.appendChild(li);
      });
    })
    .catch(() => document.getElementById('leaderboardList').textContent = 'Âä†ËΩΩÂ§±Ë¥• / Load failed');
}

window.onload = loadLeaderboard;

</script>



</body>
</html>
